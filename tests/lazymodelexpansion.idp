#include <mx>

procedure satlazy(){
	return run(getExpectedAModel())
}

procedure mxlazy(){
	return run(getExpectedNbOfModels()>0)
}

procedure run(expectsmodel) {
	stdoptions.nbmodels = 1
	stdoptions.timeout = 10
	stdoptions.groundwithbounds = false
	stdoptions.groundlazily = true
	
	partialsolution = modelexpandpartial(T,S)
	print(partialsolution)
	if(#partialsolution==0) then
		if(expectsmodel) then
			io.stderr:write("Found UNSAT, expected SAT.\n")
			return 0
		else
			io.stderr:write("Found UNSAT, expected UNSAT.\n")
			return 1
		end
	end

	stdoptions.nbmodels = 1
	stdoptions.groundlazily = false	
	if(#modelexpand(T, partialsolution[1])==0)then
		io.stderr:write("Found an invalid partial model.\n")
		return 0
	end
	io.stderr:write("Found SAT, expected SAT.\n")
	return 1
}
